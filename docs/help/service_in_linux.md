# Run the script as service

```bash
# create a service configuration file
sudo nano /etc/systemd/system/raingauge.service

# add the following content into raingauge.service and save it
# change user name and path accordingly

    [Unit]
    Description=acoustic raingauge Script Service
    After=network.target

    [Service]
    ExecStart=/usr/bin/python3 /home/pi/raingauge/src/daq_pi.py
    WorkingDirectory=/home/pi/raingauge/src
    StandardOutput=null
    StandardError=journal
    User=pi

    [Install]
    WantedBy=multi-user.target

# use the following commands
sudo systemctl daemon-reload # Reload the systemd manager configuration to recognize the new service.
sudo systemctl enable raingauge.service # Enable the service, this ensure service to start after reboot 
sudo systemctl start raingauge.service # Start the service

# use the commands to view status,stop and restart service
sudo systemctl status raingauge.service
sudo systemctl stop raingauge.service
sudo systemctl restart raingauge.service

# to see the default log of service
journalctl -u raingauge.service

```

## Important commands and directories related to service in linux

```bash
# Directories for service configuration files
/etc/systemd/system/      # primary directory
/usr/lib/systemd/system/  # Default Directory, For most Linux distributions
/lib/systemd/system/      # Default Directory, Alternative on some systems.

# List All Services
systemctl list-unit-files --type=service

# List Running Services:
systemctl list-units --type=service

# To view the contents of a specific service file:
systemctl cat <service-name>  or sudo nano <directory><service-name>

# To start,stop, restart and view the status of a service
sudo systemctl start <service-name>
sudo systemctl stop <service-name>
sudo systemctl restart <service-name>
sudo systemctl status <service-name>

sudo systemctl daemon-reload # refresh systemd manager configuration,make sure you use this when ever you edit service configuration file
sudo systemctl enable <service-name> # used to configure the service to start automatically at boot. 
sudo systemctl restart <service-name> # this will stop the running service and restart it  

# Modification of the service configuration file
# stop the service,edit and save the file,then 
sudo systemctl daemon-reload
sudo systemctl restart <service-name>
# sometimes rebooting the device is also required

# logs
by default the log of a service can be found at /var/log/journal

# to view the log(default) of a service
journalctl -u <service-name>

# to view the last 100 entries in log of a service
journalctl -n 100 -u <service-name>

# check disk space used by systemd service log
journalctl --disk-usage

# limit the size of log (modify the vacuum-size and time based on requirement)
sudo journalctl --vacuum-size=50M  or  sudo journalctl --vacuum-time=1week 

# Disable Persistent Logging
    # open and Edit the journald.conf file
    sudo nano /etc/systemd/journald.conf
    
    # change storage variable to volatile,this ensures logs are stored in RAM and cleared on reboot.
    Storage=volatile

    # Restart the journald service
    sudo systemctl restart systemd-journald
```

FAQ
* Do I need to specify the Restart, StandardOutput, or StandardError variable in the service configuration file if I don't want it?
No, you don’t need to specify the Restart, StandardOutput, or StandardError variables in the service configuration file if you don’t want to control their behavior."
*  What is the purpose of StandardOutput and StandardError? 
StandardOutput is used to capture the normal output (e.g., status messages) of the program, while StandardError captures error messages or diagnostic information generated by a program.
* Is it possible to redirect the StandardError,StandardOutput to a specific file? yes
* Is it possible to change the extension of the log file?
Yes, changing the file extension is not an issue.
* Is there any permission issue for writing logs of the service to a specific file?
No, there is no issue with writing logs to the file. However, appropriate permissions are required to view the contents of the file.
* Is normal logging still taking place at /var/log/journal even after redirecting the StandardError and StandardOutput to a specific file?
Yes, normal logging continues to take place at /var/log/journal even after redirecting StandardError and StandardOutput to a specific file.
* Will the service restart after rebooting the device?
Yes, the service will restart automatically after rebooting, assuming it has been enabled.
* If we stop the service using sudo systemctl stop raingauge.service before rebooting, will the service restart after rebooting?
Yes, if the service is enabled, it will restart automatically after rebooting.
* What is the importance of #!/usr/bin/env python3 at the top of a Python script?
The line #!/usr/bin/env python3 is called a shebang. It tells the system which interpreter to use to run the script. It ensures that the script is executed with Python 3, regardless of the user's environment.
* is it necessary to add shebang in script? no

PROBLEMS
* The error logging file is occasionally being overwritten.
* Standard output is not being written to raingauge_output.log.
* Default log storage in /var/log/* could consume significant memory; avoid restarting the script on failure to prevent excessive logging.
* If logs fill up the memory, determine how to delete them or automatically limit the log file size.
* all the setup is working in my pc ,but not working in pi,there is some errors with audio recording

