# Run the script as service

```bash
#create the service file
sudo nano /etc/systemd/system/raingauge.service

# add the following content into raingauge.service and save it
# change user name and path accordingly

    [Unit]
    Description=acoustic raingauge Script Service
    After=network.target

    [Service]
    ExecStart=/usr/bin/python3 /home/pi/raingauge/src/daq_pi.py
    WorkingDirectory=/home/pi/raingauge/src
    StandardOutput=file:/home/pi/raingauge/logs/raingauge_output.log
    StandardError=file:/home/pi/raingauge/logs/raingauge_error.log
    Restart=on-failure
    RestartSec=10
    StartLimitIntervalSec=60
    StartLimitBurst=3
    User=pi

    [Install]
    WantedBy=multi-user.target

# use the following commands
sudo systemctl daemon-reload # Reload the systemd manager configuration to recognize the new service.
sudo systemctl enable raingauge.service # Enable the service, this ensure service to start after reboot 
sudo systemctl start raingauge.service # Start the service

# use the commands to see status,stop and start service
sudo systemctl status raingauge.service
sudo systemctl stop raingauge.service
sudo systemctl restart raingauge.service

# to see the log of service, if you are storing the logs in the default directory
journalctl -u raingauge.service

```

```bash
# Explanation of the added fields:

* Restart=on-failure: The service will attempt to restart only if it exits with a failure status.
* RestartSec=5: Sets a delay of 5 seconds before each restart attempt.
* StartLimitIntervalSec=60: Sets a 60-second window to control the restart behavior.
* StartLimitBurst=3: Allows up to 3 restart attempts within the StartLimitIntervalSec window.

# store StandardOutput and StandardErrors of service to a specific location
* StandardOutput=file:/home/pi/raingauge/logs/raingauge_output.log
* StandardError=file:/home/pi/raingauge/logs/raingauge_error.log
```

## Important commands and directories related to service in linux

```bash
# Directories for service configuration files
/etc/systemd/system/      # primary directory
/usr/lib/systemd/system/  # Default Directory, For most Linux distributions
/lib/systemd/system/      # Default Directory, Alternative on some systems.

# List All Services
systemctl list-unit-files --type=service

# List Running Services:
systemctl list-units --type=service

# To view the contents of a specific service file:
systemctl cat <service-name>  or sudo nano <directory><service-name>

# To start,stop, restart and view the status of a service
sudo systemctl start <service-name>
sudo systemctl stop <service-name>
sudo systemctl restart <service-name>
sudo systemctl status <service-name>

sudo systemctl daemon-reload # refresh systemd manager configuration,make sure you use this when ever you edit service configuration file
sudo systemctl enable <service-name> # used to configure the service to start automatically at boot. 
sudo systemctl restart <service-name> # this will stop the running service and restart it  

# logs
by default the log of a service can be found at /var/log/journal

# to view the log(default) of a service
journalctl -u <service-name>

# to view the last 100 entries in log of a service
journalctl -n 100 -u <service-name>

# Disable Persistent Logging
    # open and Edit the journald.conf file
    sudo nano /etc/systemd/journald.conf
    
    # change storage variable to volatile,this ensures logs are stored in RAM and cleared on reboot.
    Storage=volatile

    # Restart the journald service
    sudo systemctl restart systemd-journald
```

FAQ
* Is it possible to change the extension of the log file?
Yes, changing the file extension is not an issue.

* Is there any permission issue for writing logs of the service to a specific file?
No, there is no issue with writing logs to the file. However, appropriate permissions are required to view the contents of the file.

* Is normal logging still taking place at /var/log/journal even after using the command StandardError=file:/home/pi/raingauge/logs/raingauge_error.log?
Yes, normal logging continues to take place at /var/log/journal even after redirecting StandardError to a file.

* Will the service restart after rebooting the device?
Yes, the service will restart automatically after rebooting, assuming it has been enabled.

* If we stop the service using sudo systemctl stop raingauge.service before rebooting, will the service restart after rebooting?
Yes, if the service is enabled, it will restart automatically after rebooting.

* What is the purpose of StandardOutput and StandardError?
StandardOutput is used to capture the normal output (e.g., status messages), while StandardError captures error messages or diagnostic information generated by a program.

* What is the importance of #!/usr/bin/env python3 at the top of a Python script?
The line #!/usr/bin/env python3 is called a shebang. It tells the system which interpreter to use to run the script. It ensures that the script is executed with Python 3, regardless of the user's environment.


TODO
* logging file is overwriting every time,how to resolve
* default log storing in /var/log/* may fill up alot of memory,so avoid restarting the script on failure,or limit the number of time the script can restart on failure
* if we add no restart on failure in service script,we need to start the service manually after solving error in script. but if we add restart feature this will help to run the scipt automatically after resolving the error in script.
* if the memory is filled up by logs ,how to delete it or keep a limit on log file size

